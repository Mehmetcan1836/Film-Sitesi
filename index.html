<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Film Sitesi - En Yeni Filmler ve Diziler</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    <script src="/js/header.js"></script>

</head>
<body>
    <div id="header-placeholder"></div>
    
    <main class="main-content">
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <h1>En İyi Film ve Diziler Burada</h1>
                <p>Binlerce film ve dizi arasından seçimini yap, istediğin zaman izle. Yüksek kaliteli içerikler sadece bir tık uzağında.</p>
                <div class="hero-buttons">
                    <a href="#trending" class="btn btn-primary"><i class="fas fa-play"></i> Hemen İzle</a>
                    <a href="#trending" class="btn btn-outline"><i class="fas fa-info-circle"></i> Daha Fazla Bilgi</a>
                </div>
            </div>
        </section>

        <div class="container">
            <!-- Trending Now Section -->
            <section class="trending-section" id="trending">
                <div class="section-header">
                    <h2><i class="fas fa-fire"></i> Trendler</h2>
                    <a href="#" class="view-all">Tümünü Gör <i class="fas fa-arrow-right"></i></a>
                </div>
                <div class="movie-grid" id="trending-container">
                    <!-- Trending content will be loaded here -->
                </div>
            </section>
            
            <!-- Popular Movies Section -->
            <section class="featured-section">
                <div class="section-header">
                    <h2><i class="fas fa-film"></i> Popüler Filmler</h2>
                    <a href="filmler.html" class="view-all">Tümünü Gör <i class="fas fa-arrow-right"></i></a>
                </div>
                <div class="movie-grid" id="movies-container">
                    <!-- Movies will be loaded here -->
                </div>
            </section>
            
            <!-- Popular Series Section -->
            <section class="featured-section series-section">
                <div class="section-header">
                    <h2><i class="fas fa-tv"></i> Popüler Diziler</h2>
                    <a href="diziler.html" class="view-all">Tümünü Gör <i class="fas fa-arrow-right"></i></a>
                </div>
                <div class="movie-grid" id="series-container">
                    <!-- Series will be loaded here -->
                </div>
            </section>
        </div>
    </main>

    <footer class="footer mt-5 py-4 bg-dark text-white">
        <div class="container text-center">
            <p class="mb-0">© 2023 Film Sitesi. Tüm hakları saklıdır.</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Sample data in case JSON files fail to load
        const sampleMovies = [];
        const sampleSeries = [];

        // Function to create movie/series card HTML
        function createMovieElement(movie, isTrending = false) {
            if (!movie) return '';
            
            const isSeries = movie.type && (movie.type.toLowerCase() === 'dizi' || movie.type.toLowerCase() === 'series');
            const detailUrl = isSeries ? `diziler/ben10-classic/ben10.html` : `film-detay.html?id=${movie.id || ''}`;
            const imageUrl = movie.image && movie.image.trim() !== '' ? movie.image : 'img/placeholder.jpg';
            const year = movie.year || 'Bilinmiyor';
            const rating = movie.rating ? movie.rating.toFixed(1) : 'N/A';
            const genre = movie.genre ? movie.genre.split(',')[0].trim() : 'Belirtilmemiş';
            
            // Add trending badge if it's in trending section
            const trendingBadge = isTrending ? `
                <div class="trending-badge">
                    <i class="fas fa-fire"></i> Trend
                </div>` : '';
            
            return `
                <div class="movie-card" data-id="${movie.id || ''}">
                    ${trendingBadge}
                    <div class="movie-poster">
                        <img src="${imageUrl}" alt="${movie.title || 'İçerik'}" onerror="this.onerror=null; this.src='img/placeholder.jpg';">
                        <div class="movie-overlay">
                            <a href="${detailUrl}" class="play-btn" title="İzle"><i class="fas fa-play"></i></a>
                            <button class="favorite-btn" title="Favorilere Ekle"><i class="far fa-heart"></i></button>
                            <a href="${detailUrl}" class="btn btn-outline btn-sm mt-3">Detaylar</a>
                        </div>
                    </div>
                    <div class="movie-info">
                        <h3>${movie.title || 'İsimsiz İçerik'}</h3>
                        <div class="movie-meta">
                            <span>${year}</span>
                            <span>•</span>
                            <span>${genre}</span>
                            <span class="rating">
                                <i class="fas fa-star"></i> ${rating}
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Function to load content data
        async function loadContentData() {
            try {
                // Try to load from JSON files
                const [moviesResponse, seriesResponse] = await Promise.all([
                    fetch('data/movies.json').catch(() => ({ json: () => ({ content: sampleMovies }) })),
                    fetch('data/series.json').catch(() => ({ json: () => ({ series: sampleSeries }) }))
                ]);
                
                const moviesData = await moviesResponse.json();
                const seriesData = await seriesResponse.json();
                
                // Get movies and series
                const movies = moviesData.content || moviesData.movies || [];
                const series = seriesData.series || [];
                
                // Combine and shuffle for trending
                const allContent = [...movies, ...series];
                const trending = [...allContent].sort(() => 0.5 - Math.random()).slice(0, 6);
                
                // Display trending
                const trendingContainer = document.getElementById('trending-container');
                if (trendingContainer) {
                    trendingContainer.innerHTML = trending
                        .slice(0, 6)
                        .map(item => createMovieElement(item, true))
                        .join('') || '<div class="error-message"><i class="fas fa-exclamation-circle"></i> İçerik bulunamadı</div>';
                }
                
                // Display movies
                const moviesContainer = document.getElementById('movies-container');
                if (moviesContainer) {
                    moviesContainer.innerHTML = movies
                        .filter(movie => !movie.type || movie.type.toLowerCase() === 'film')
                        .slice(0, 8)
                        .map(movie => createMovieElement(movie))
                        .join('') || '<div class="error-message"><i class="fas fa-exclamation-circle"></i> Film bulunamadı</div>';
                }
                
                // Display series
                const seriesContainer = document.getElementById('series-container');
                if (seriesContainer) {
                    seriesContainer.innerHTML = series
                        .filter(series => series.type && (series.type.toLowerCase() === 'dizi' || series.type.toLowerCase() === 'series'))
                        .slice(0, 8)
                        .map(series => createMovieElement(series))
                        .join('') || '<div class="error-message"><i class="fas fa-exclamation-circle"></i> Dizi bulunamadı</div>';
                }
                
                // Initialize favorite buttons
                initializeFavoriteButtons();
                
            } catch (error) {
                console.error('Error loading content data:', error);
                showError('İçerik yüklenirken bir hata oluştu. Lütfen daha sonra tekrar deneyin.');
            }
        }
        
        // Initialize favorite buttons
        function initializeFavoriteButtons() {
            document.querySelectorAll('.favorite-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    this.classList.toggle('active');
                    const icon = this.querySelector('i');
                    if (icon) {
                        icon.classList.toggle('far');
                        icon.classList.toggle('fas');
                    }
                });
            });
        }
        
        // Show error message
        function showError(message) {
            const moviesContainer = document.getElementById('movies-container');
            if (moviesContainer) {
                moviesContainer.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>${message}</p>
                    </div>
                `;
            }
        }
        
        // Load header
        function loadHeader() {
            const headerPlaceholder = document.getElementById('header-placeholder');
            if (headerPlaceholder) {
                fetch('header.html')
                    .then(response => response.text())
                    .then(html => {
                        headerPlaceholder.innerHTML = html;
                    })
                    .catch(error => {
                        console.error('Error loading header:', error);
                    });
            }
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            loadHeader();
            loadContentData();
        });
    </script>
</body>
</html>
