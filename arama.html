<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arama - Dizicom</title>
    <link rel="shortcut icon" href="img/logos.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/movie-grid.css">
    <style>
        body{background:#141414;color:#fff;font-family:Poppins,sans-serif}
        .main-content{min-height:100vh;padding:20px}
        .search-header{background:linear-gradient(135deg, #1f1f1f 0%, #141414 100%);padding:50px 20px;margin-bottom:40px;border-bottom:2px solid #e50914;box-shadow:0 4px 20px rgba(229,9,20,0.2)}
        .search-title{font-size:2rem;font-weight:700;margin-bottom:15px;letter-spacing:0.5px}
        .search-query{color:#e50914;font-weight:bold;text-shadow:0 0 10px rgba(229,9,20,0.3)}
        .result-count{color:#b0b0b0;font-size:1rem;margin-top:10px}
        .filter-chips{display:flex;gap:12px;margin-top:20px;flex-wrap:wrap}
        .filter-chip{background:#2a2a2a;color:#fff;border-radius:25px;padding:10px 20px;border:2px solid #3a3a3a;cursor:pointer;font-weight:500;transition:all 0.3s ease;font-size:0.95rem}
        .filter-chip:hover{border-color:#e50914;background:#2a2a2a;transform:translateY(-2px)}
        .filter-chip.active{background:#e50914;border-color:#e50914;box-shadow:0 0 15px rgba(229,9,20,0.5)}
        .movie-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:25px;margin:40px 0;padding:20px 0}
        .no-results{text-align:center;padding:80px 20px;color:#999;grid-column:1/-1;font-size:1.1rem}
        .loading-spinner{text-align:center;padding:40px 20px;grid-column:1/-1}
    </style>
        <link rel="stylesheet" href="css/header.css">
</head>
<body>
    <div id="header-container"></div>
    <div class="search-header">
        <div class="container">
            <h2 class="search-title">Arama: <span id="sq" class="search-query"></span></h2>
            <p id="rc" class="result-count"></p>
            <div class="filter-chips">
                <button class="filter-chip active" data-type="all">Tümü</button>
                <button class="filter-chip" data-type="movie">Filmler</button>
                <button class="filter-chip" data-type="tv">Diziler</button>
                <button class="filter-chip" data-type="person">Oyuncular</button>
            </div>
        </div>
    </div>
    <main class="main-content">
        <div class="container">
            <div id="sr" class="movie-grid"><div class="no-results">Aranıyor...</div></div>
        </div>
    </main>
    <div id="mediaModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content" style="background:linear-gradient(135deg, #1a1a1a 0%, #141414 100%);border:1px solid rgba(229,9,20,0.3);border-radius:12px">
                <div class="modal-header" style="border-bottom:2px solid rgba(229,9,20,0.2);padding:18px 20px">
                    <h5 id="modalTitle" class="modal-title" style="font-weight:700;color:#fff"></h5>
                    <button class="btn-close btn-close-white" data-bs-dismiss="modal" style="filter:brightness(1.2)"></button>
                </div>
                <div id="modalBody" class="modal-body" style="color:#fff;padding:25px"></div>
            </div>
        </div>
    </div>
    <div id="playerModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content" style="background: #000; border: 1px solid rgba(229,9,20,0.3); border-radius: 12px; max-height: 90vh; overflow: hidden;">
                <!-- Header -->
                <div class="modal-header" style="background: #141414; border-bottom: 1px solid #333; padding: 15px 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; flex: 1;">
                        <button class="btn btn-outline-danger btn-sm" onclick="goBack()" style="display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-arrow-left"></i>
                            <span>Geri</span>
                        </button>
                        <h5 id="playerTitle" class="modal-title mb-0" style="font-weight: 700; color: #fff; font-size: 1.2rem;"></h5>
                    </div>
                    <button class="btn btn-outline-danger btn-sm" id="previousEpisodeBtn" onclick="previousEpisode()" style="display: none; margin-right: 10px;">
                        <i class="fas fa-arrow-left"></i>
                        <span>Önceki Bölüm</span>
                    </button>
                    <button class="btn btn-outline-danger btn-sm" id="nextEpisodeBtn" onclick="nextEpisode()" style="display: none; margin-right: 10px;">
                        <span>Sonraki Bölüm</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" style="filter: brightness(1.2);"></button>
                </div>

                <!-- Player -->
                <div class="modal-body" style="padding: 0; background: #000;">
                    <div id="playerContent" style="height: 500px; display: flex; align-items: center; justify-content: center; background: #000;">
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; color: #fff;">
                            <div style="width: 50px; height: 50px; border: 4px solid #333; border-top: 4px solid #e50914; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <span>Video yükleniyor...</span>
                        </div>
                    </div>

                    <!-- Episode Selector (for TV shows) -->
                    <div id="episodeSelector" style="background: #141414; padding: 20px; border-top: 1px solid #333; display: none;">
                        <h5 style="color: #e50914; margin-bottom: 15px; font-weight: 700;"><i class="fas fa-tv"></i> Sezonları Seçin</h5>
                        <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;" id="seasonsContainer"></div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; padding-right: 10px; max-height: 400px; overflow-y: auto;" id="episodesGrid"></div>
                    </div>

                    <!-- Recommendations Section -->
                    <div id="recommendationsSection" style="background: #141414; padding: 20px; border-top: 1px solid #333; display: none;">
                        <h5 style="color: #e50914; margin-bottom: 15px; font-weight: 700;"><i class="fas fa-thumbs-up"></i> Önerilen İçerikler</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;" id="recommendationsGrid"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .episode-btn {
            padding: 15px;
            background: #1a1a1a;
            border: 1px solid #333;
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            height: 120px;
            overflow: hidden;
        }

        .episode-poster {
            width: 80px;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .episode-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .episode-number {
            font-weight: 700;
            color: #e50914;
            font-size: 1rem;
        }

        .episode-title {
            font-weight: 600;
            color: #fff;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .episode-info {
            font-size: 0.8rem;
            color: #ccc;
            line-height: 1.2;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .episode-btn:hover, .episode-btn.active {
            background: #e50914;
            border-color: #e50914;
        }

        .season-btn {
            padding: 8px 16px;
            background: #1a1a1a;
            border: 2px solid #333;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .season-btn.active, .season-btn:hover {
            background: #e50914;
            border-color: #e50914;
            color: #fff;
        }

        .recommendation-item {
            background: #1a1a1a;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid #333;
        }

        .recommendation-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(229, 9, 20, 0.3);
            border-color: #e50914;
        }

        .recommendation-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .rec-title {
            padding: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #fff;
            text-align: center;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        #episodesGrid::-webkit-scrollbar {
            width: 6px;
        }

        #episodesGrid::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 3px;
        }

        #episodesGrid::-webkit-scrollbar-thumb {
            background: #e50914;
            border-radius: 3px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/header.js"></script>
    <script src="data/app.js"></script>
    <script>
const API='999a2c8d29cd1833fa98446f909f19eb',B='https://api.themoviedb.org/3',I='https://image.tmdb.org/t/p/w342';
const params = new URLSearchParams(window.location.search);
const q = params.get('q') || '';
const genreParam = params.get('genre') || '';
const genreNameParam = params.get('genreName') || '';
let f='all',r=[],currentPage=1,totalPages=1,hasMoreResults=false;

document.getElementById('sq').textContent = q ? `"${q}"` : (genreNameParam ? genreNameParam : ' ');
document.querySelectorAll('.filter-chip').forEach(e=>e.onclick=()=>{
document.querySelectorAll('.filter-chip').forEach(c=>c.classList.remove('active'));
e.classList.add('active');f=e.dataset.type;currentPage=1;render();
});

async function search(){
if(!q){document.getElementById('sr').innerHTML='<div class="no-results">Terimi girin</div>';return}
document.getElementById('sr').innerHTML='<div style="text-align:center;padding:40px;color:#aaa">Aranıyor...</div>';
try{
const[m,t,p]=await Promise.all([
fetch(`${B}/search/movie?api_key=${API}&query=${encodeURIComponent(q)}&page=${currentPage}`),
fetch(`${B}/search/tv?api_key=${API}&query=${encodeURIComponent(q)}&page=${currentPage}`),
fetch(`${B}/search/person?api_key=${API}&query=${encodeURIComponent(q)}&page=${currentPage}`)
]);
const movies=(await m.json()).results.map(x=>({...x,media_type:'movie'}));
const tv=(await t.json()).results.map(x=>({...x,media_type:'tv'}));
const persons=(await p.json()).results.map(x=>({...x,media_type:'person'}));
r=[...movies,...tv,...persons].sort((a,b)=>(b.popularity||0)-(a.popularity||0));
render();
}catch(e){document.getElementById('sr').innerHTML='<div class="no-results">Hata</div>'}
}

function render(){
let l=f==='all'?r:r.filter(i=>i.media_type===f);
if(!l.length){document.getElementById('sr').innerHTML='<div class="no-results">Yok</div>';document.getElementById('rc').textContent='0';return}
document.getElementById('rc').textContent=`${l.length} sonuç`;
let html=l.map(i=>{
if(i.media_type==='person'){
return `
<div class="movie-card" onclick="window.location.href='actor-detail.html?id=${i.id}'">
<div class="media-poster-container">
<img src="${i.profile_path?I+i.profile_path:'/placeholder.svg?height=450&width=300'}" alt="${i.name}" class="media-poster" loading="lazy">
<div class="media-overlay"><i class="fas fa-user play-icon"></i></div>
</div>
<div class="media-info">
<h3 class="media-title">${i.name}</h3>
<div class="media-rating"><div class="rating-stars"><i class="fas fa-star"></i><span>${i.popularity?.toFixed(1)||'N/A'}</span></div></div>
</div>
</div>
`;
}else{
return `
<div class="movie-card" onclick="showMediaDetails(${i.id},'${i.media_type}')">
<div class="media-poster-container">
<img src="${i.poster_path?I+i.poster_path:'/placeholder.svg?height=450&width=300'}" alt="${i.title||i.name}" class="media-poster" loading="lazy">
<div class="media-overlay"><i class="fas fa-play play-icon"></i></div>
</div>
<div class="media-info">
<h3 class="media-title">${i.title||i.name}</h3>
<div class="media-rating"><div class="rating-stars"><i class="fas fa-star"></i><span>${i.vote_average?.toFixed(1)||'N/A'}</span></div></div>
</div>
</div>
`;
}
}).join('');
if(hasMoreResults){
html+=`<div class="load-more-container" style="grid-column:1/-1;text-align:center;padding:20px"><button id="loadMoreBtn" class="btn btn-danger" style="padding:12px 30px;font-weight:600;border-radius:25px">Daha Fazla Göster</button></div>`;
}
document.getElementById('sr').innerHTML=html;
document.getElementById('loadMoreBtn')?.addEventListener('click',loadMore);
}

async function loadMore(){
currentPage++;
document.getElementById('loadMoreBtn').innerHTML='<i class="fas fa-spinner fa-spin"></i> Yükleniyor...';
document.getElementById('loadMoreBtn').disabled=true;
try{
const[m,t,p]=await Promise.all([
fetch(`${B}/search/movie?api_key=${API}&query=${encodeURIComponent(q)}&page=${currentPage}`),
fetch(`${B}/search/tv?api_key=${API}&query=${encodeURIComponent(q)}&page=${currentPage}`),
fetch(`${B}/search/person?api_key=${API}&query=${encodeURIComponent(q)}&page=${currentPage}`)
]);
const movies=(await m.json()).results.map(x=>({...x,media_type:'movie'}));
const tv=(await t.json()).results.map(x=>({...x,media_type:'tv'}));
const persons=(await p.json()).results.map(x=>({...x,media_type:'person'}));
const newResults=[...movies,...tv,...persons].sort((a,b)=>(b.popularity||0)-(a.popularity||0));
r=[...r,...newResults];
hasMoreResults=newResults.length>=20;
render();
}catch(e){
document.getElementById('loadMoreBtn').innerHTML='Daha Fazla Göster';
document.getElementById('loadMoreBtn').disabled=false;
}
}

// If a genre parameter is present, load by genre; otherwise perform normal search
async function fetchAllPopular(page) {
    try {
        const [movieRes, tvRes] = await Promise.all([
            fetch(`${B}/movie/popular?api_key=${API}&language=tr-TR&page=${page}`),
            fetch(`${B}/tv/popular?api_key=${API}&language=tr-TR&page=${page}`)
        ]);
        const movieData = await movieRes.json();
        const tvData = await tvRes.json();
        const movies = movieData.results.map(x => ({ ...x, media_type: 'movie' }));
        const tv = tvData.results.map(x => ({ ...x, media_type: 'tv' }));
        const combined = [...movies, ...tv].sort((a, b) => (b.popularity || 0) - (a.popularity || 0));
        return { results: combined, totalPages: Math.max(movieData.total_pages || 1, tvData.total_pages || 1) };
    } catch (err) {
        console.error('Fetching all popular failed', err);
        return { results: [], totalPages: 1 };
    }
}

async function searchByGenre(genres, page) {
    try {
        const [movieRes, tvRes] = await Promise.all([
            fetch(`${B}/discover/movie?api_key=${API}&with_genres=${encodeURIComponent(genres)}&language=tr-TR&page=${page}`),
            fetch(`${B}/discover/tv?api_key=${API}&with_genres=${encodeURIComponent(genres)}&language=tr-TR&page=${page}`)
        ]);
        const movieData = await movieRes.json();
        const tvData = await tvRes.json();
        const movies = movieData.results.map(x => ({ ...x, media_type: 'movie' }));
        const tv = tvData.results.map(x => ({ ...x, media_type: 'tv' }));
        const combined = [...movies, ...tv].sort((a, b) => (b.popularity || 0) - (a.popularity || 0));
        return { results: combined, totalPages: Math.max(movieData.total_pages || 1, tvData.total_pages || 1) };
    } catch (err) {
        console.error('Genre search failed', err);
        return { results: [], totalPages: 1 };
    }
}

async function loadResults() {
    document.getElementById('sr').innerHTML = '<div style="text-align:center;padding:40px;color:#aaa">Yükleniyor...</div>';
    if (genreParam) {
        document.getElementById('sq').textContent = genreNameParam ? genreNameParam : `Tür ${genreParam}`;
        const { results, totalPages: tp } = await searchByGenre(genreParam, currentPage);
        r = [...r, ...results];
        totalPages = tp;
        hasMoreResults = currentPage < totalPages;
        render();
    } else if (q) {
        document.getElementById('sq').textContent = `"${q}"`;
        try {
            const [movieRes, tvRes, personRes] = await Promise.all([
                fetch(`${B}/search/movie?api_key=${API}&query=${encodeURIComponent(q)}&page=${currentPage}`),
                fetch(`${B}/search/tv?api_key=${API}&query=${encodeURIComponent(q)}&page=${currentPage}`),
                fetch(`${B}/search/person?api_key=${API}&query=${encodeURIComponent(q)}&page=${currentPage}`)
            ]);
            const movieData = await movieRes.json();
            const tvData = await tvRes.json();
            const personData = await personRes.json();
            const movies = movieData.results.map(x => ({ ...x, media_type: 'movie' }));
            const tv = tvData.results.map(x => ({ ...x, media_type: 'tv' }));
            const persons = personData.results.map(x => ({ ...x, media_type: 'person' }));
            r = [...r, ...movies, ...tv, ...persons].sort((a, b) => (b.popularity || 0) - (a.popularity || 0));
            totalPages = Math.max(movieData.total_pages || 1, tvData.total_pages || 1, personData.total_pages || 1);
            hasMoreResults = currentPage < totalPages;
            render();
        } catch (e) {
            document.getElementById('sr').innerHTML = '<div class="no-results">Hata</div>';
        }
    } else {
        document.getElementById('sq').textContent = 'Popüler İçerikler';
        const { results, totalPages: tp } = await fetchAllPopular(currentPage);
        r = [...r, ...results];
        totalPages = tp;
        hasMoreResults = currentPage < totalPages;
        render();
    }
}

loadResults();
    </script>
</body>
</html>
